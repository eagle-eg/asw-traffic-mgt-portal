const translations = {
    en: {
        platformTitle: "General Administration of Aswan Traffic",
        heroHeading: "Your comprehensive guide to licensing procedures",
        heroSubheading: "Understand requirements, documents, and steps before visiting the traffic office.",
        btnLicenseProcedures: "License Procedures",
        btnSubmitComplaint: "Submit a Complaint",
        btnAdminDashboard: "Traffic Manager Dashboard",
        footerText: "&copy; 2025 Egyptian Traffic Services. All rights reserved.",

        // License Procedures Page
        personalLicenseTab: "Personal Driving License",
        vehicleLicenseTab: "Vehicle License",
        personalLicenseTitle: "Personal Driving License Procedures",
        vehicleLicenseTitle: "Vehicle License Procedures (First Time)",

        personalStep1Title: "Step 1: Application Form",
        personalStep1Desc: "Fill out Form 256 Traffic.",
        personalStep2Title: "Step 2: Personal Identification",
        personalStep2Desc: "Valid National ID or Passport + copy.",
        personalStep3Title: "Step 3: Personal Photos",
        personalStep3Desc: "3 personal photos.",
        personalStep4Title: "Step 4: Educational Qualification",
        personalStep4Desc: "Original educational qualification + copy.",
        personalStep5Title: "Step 5: File and Folder",
        personalStep5Desc: "New file and folder.",
        personalStep6Title: "Step 6: Medical Examination",
        personalStep6Desc: "Medical examination (within the unit).",
        personalStep7Title: "Step 7: Theoretical Driving Test",
        personalStep7Desc: "Pass the theoretical driving test.",
        personalStep8Title: "Step 8: Practical Driving Test",
        personalStep8Desc: "Pass the practical driving test.",
        personalStep9Title: "Step 9: Fee Payment",
        personalStep9Desc: "Pay the prescribed fees and taxes.",

        vehicleStep1Title: "Step 1: Application Form",
        vehicleStep1Desc: "Fill out Form 251 Traffic for each year.",
        vehicleStep2Title: "Step 2: Personal Identification",
        vehicleStep2Desc: "Valid National ID or Passport + copy.",
        vehicleStep3Title: "Step 3: Ownership Documents",
        vehicleStep3Desc: "Certificate of origin (local) or customs release (imported) + copy of circular with chassis number.",
        vehicleStep4Title: "Step 4: File and Folder",
        vehicleStep4Desc: "File and folder.",
        vehicleStep5Title: "Step 5: Technical Inspection",
        vehicleStep5Desc: "Technical inspection (every three years).",
        vehicleStep6Title: "Step 6: Fee Payment",
        vehicleStep6Desc: "Pay the prescribed fees and taxes.",
        vehicleNoteTitle: "Note: In case of Authorization",
        vehicleNoteDesc: "Personal identification of the owner + personal identification of the agent + original authorization + copies thereof.",

        // Complaints Page
        complaintLabel: "Your Complaint:",
        complaintPlaceholder: "Write your complaint here...",
        cityLabel: "Select City:",
        selectCityPlaceholder: "-- Select City --",
        cityKomOmbo: "Kom Ombo",
        cityEdfu: "Edfu",
        cityAswan: "Aswan",
        submitComplaintBtn: "Submit Complaint",
        complaintSuccess: "Your complaint has been submitted successfully. Thank you for your feedback!",

        // Admin Dashboard
        adminDashboardTitle: "Traffic Manager Dashboard",
        filterByCityLabel: "Filter by City:",
        filterAllCities: "All Cities",
        tableHeaderID: "ID",
        tableHeaderCity: "City",
        tableHeaderComplaint: "Complaint",
        tableHeaderTimestamp: "Timestamp",
        noComplaintsFound: "No complaints found.",
        drivingLicenseBtn: "Driving License",
        vehicleLicenseBtn: "Vehicle License",
        backBtn: "Back",
        printBtn: "Print"
    },
    ar: {
        platformTitle: "ادارة مرور اسوان",
        heroHeading: "دليلك الشامل لإجراءات التراخيص",
        heroSubheading: "افهم المتطلبات والمستندات والخطوات قبل زيارة مكتب المرور.",
        btnLicenseProcedures: "إجراءات التراخيص",
        btnSubmitComplaint: "تقديم اقتراح او شكوى",
        btnAdminDashboard: "لوحة تحكم مدير المرور",
        footerText: "© 2025 خدمات المرور المصرية. جميع الحقوق محفوظة.",

        // License Procedures Page
        personalLicenseTab: "رخصة القيادة الخاصة",
        vehicleLicenseTab: "رخصة المركبة",
        personalLicenseTitle: "إجراءات ترخيص القيادة الخاصة",
        vehicleLicenseTitle: "إجراءات ترخيص مركبة مالكي (أول مرة)",

        personalStep1Title: "الخطوة 1: نموذج الطلب",
        personalStep1Desc: "تعبئة نموذج 256 مرور.",
        personalStep2Title: "الخطوة 2: تحقيق الشخصية",
        personalStep2Desc: "بطاقة الرقم القومي سارية أو جواز سفر + صورة منه.",
        personalStep3Title: "الخطوة 3: صور شخصية",
        personalStep3Desc: "3 صور شخصية.",
        personalStep4Title: "الخطوة 4: المؤهل الدراسي",
        personalStep4Desc: "أصل المؤهل الدراسي + صورة منه.",
        personalStep5Title: "الخطوة 5: ملف وحافظة",
        personalStep5Desc: "ملف جديد + حافظة.",
        personalStep6Title: "الخطوة 6: الكشف الطبي",
        personalStep6Desc: "الكشف الطبي (داخل الوحدة).",
        personalStep7Title: "الخطوة 7: اختبار القيادة النظري",
        personalStep7Desc: "اجتياز اختبار القيادة النظري.",
        personalStep8Title: "الخطوة 8: اختبار القيادة العملي",
        personalStep8Desc: "اجتياز اختبار القيادة العملي.",
        personalStep9Title: "الخطوة 9: سداد الرسوم",
        personalStep9Desc: "سداد الرسوم والضريبة المقررة.",

        vehicleStep1Title: "الخطوة 1: نموذج الطلب",
        vehicleStep1Desc: "تعبئة نموذج 251 مرور عن كل عام.",
        vehicleStep2Title: "الخطوة 2: تحقيق الشخصية",
        vehicleStep2Desc: "بطاقة الرقم القومي سارية أو جواز سفر + صورة منه.",
        vehicleStep3Title: "الخطوة 3: مستندات الملكية",
        vehicleStep3Desc: "شهادة منشأ (للمحلي) أو إفراج جمركي (للمستورد) + صورة من المنشور الدوري برقم الشاسيه.",
        vehicleStep4Title: "الخطوة 4: ملف وحافظة",
        vehicleStep4Desc: "ملف + حافظة.",
        vehicleStep5Title: "الخطوة 5: الفحص الفني",
        vehicleStep5Desc: "الفحص الفني (كل ثلاث سنوات).",
        vehicleStep6Title: "الخطوة 6: سداد الرسوم",
        vehicleStep6Desc: "سداد الرسوم والضريبة المقررة.",
        vehicleNoteTitle: "ملاحظة: في حالة التوكيل",
        vehicleNoteDesc: "تحقيق شخصية المالك + تحقيق شخصية الوكيل + التوكيل + صورة منهم.",

        // Complaints Page
        complaintLabel: "شكواك:",
        complaintPlaceholder: "اكتب شكواك هنا...",
        cityLabel: "اختر المدينة:",
        selectCityPlaceholder: "-- اختر المدينة --",
        cityKomOmbo: "كوم أمبو",
        cityEdfu: "إدفو",
        cityAswan: "أسوان",
        submitComplaintBtn: "إرسال الشكوى",
        complaintSuccess: "تم تقديم شكواك بنجاح. شكراً لملاحظاتك!",

        // Admin Dashboard
        adminDashboardTitle: "لوحة تحكم مدير المرور",
        filterByCityLabel: "تصفية حسب المدينة:",
        filterAllCities: "جميع المدن",
        tableHeaderID: "الرقم التعريفي",
        tableHeaderCity: "المدينة",
        tableHeaderComplaint: "الشكوى",
        tableHeaderTimestamp: "التاريخ والوقت",
        noComplaintsFound: "لا توجد شكاوى.",
        drivingLicenseBtn: "رخصة قيادة",
        vehicleLicenseBtn: "رخصة مركبة",
        backBtn: "عودة",

        printBtn: "طباعة"
    }
};

function setLanguage(lang) {
    currentLang = lang; // update global lang variable

    // Update all elements with data-lang-key
    document.querySelectorAll('[data-lang-key]').forEach(element => {
        const key = element.getAttribute('data-lang-key');
        if (translations[lang] && translations[lang][key]) {
            if (element.tagName === 'INPUT' && element.hasAttribute('placeholder')) {
                element.setAttribute('placeholder', translations[lang][key]);
            } else {
                element.textContent = translations[lang][key];
            }
        }
    });

    // Update modal content once if modal is open
    const stepsModal = document.getElementById("stepsModal");
    if (stepsModal && stepsModal.classList.contains("show")) {
        const stepsModalLabel = document.getElementById("stepsModalLabel");
        if (stepsModalLabel) {
            const typeName = stepsModalLabel.textContent.trim();
            // Use your modal update function name here
            if (typeof showSteps === "function") {
                showSteps(typeName);
            } else if (typeof openStepsModal === "function") {
                openStepsModal(typeName);
            }
        }
    }

    // Handle specific elements that need special treatment (e.g., select options)
    const citySelectOptions = {
        en: {
            'Kom Ombo': 'Kom Ombo',
            'Edfu': 'Edfu',
            'Aswan': 'Aswan',
            '-- Select City --': '-- Select City --',
            'All Cities': 'All Cities'
        },
        ar: {
            'Kom Ombo': 'كوم أمبو',
            'Edfu': 'إدفو',
            'Aswan': 'أسوان',
            '-- Select City --': '-- اختر المدينة --',
            'All Cities': 'جميع المدن'
        }
    };

    const citySelects = document.querySelectorAll('#citySelect, #filterCity');
    citySelects.forEach(selectElement => {
        Array.from(selectElement.options).forEach(option => {
            // Use option.value or option.textContent as key to map translation
            const originalText = option.getAttribute('data-original-text') || option.textContent.trim();

            // Store original text in data attribute if not already stored
            if (!option.hasAttribute('data-original-text')) {
                option.setAttribute('data-original-text', originalText);
            }

            if (citySelectOptions[lang][originalText]) {
                option.textContent = citySelectOptions[lang][originalText];
            }
        });
    });

    // Update body class for styling (add lang class, remove others)
    document.body.classList.remove('en', 'ar');
    document.body.classList.add(lang);

    // Set text direction attribute
    document.body.setAttribute('dir', lang === 'ar' ? 'rtl' : 'ltr');

    // Save language preference
    localStorage.setItem('currentLang', lang);
}

document.addEventListener('DOMContentLoaded', () => {
    const savedLang = localStorage.getItem('currentLang') || 'en';
    setLanguage(savedLang);

    const btnEn = document.getElementById('lang-en');
    const btnAr = document.getElementById('lang-ar');

    if (btnEn) btnEn.addEventListener('click', () => setLanguage('en'));
    if (btnAr) btnAr.addEventListener('click', () => setLanguage('ar'));
});
